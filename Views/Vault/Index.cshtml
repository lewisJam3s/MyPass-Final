@model List<MyPass.Models.ViewModels.Vault.VaultItemViewModel>

@{
    ViewData["Title"] = "My Vault";
    Layout = "_Layout";
}

<style>
    .vault-header {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 20px;
    }

    .vault-actions {
        margin-bottom: 25px;
    }

        .vault-actions a {
            margin-right: 15px;
            text-decoration: none;
            color: #0d6efd;
            font-weight: 600;
            font-size: 1rem;
        }

    .vault-empty {
        font-style: italic;
        color: #444;
        margin-top: 20px;
    }

    .vault-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }

    .vault-card {
        background: white;
        border-radius: 10px;
        padding: 18px;
        box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        transition: 0.2s ease;
    }

        .vault-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 14px rgba(0,0,0,0.12);
        }

    .vault-card-title {
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: 3px;
    }

    .vault-card-type {
        font-size: 0.9rem;
        color: gray;
        margin-bottom: 12px;
    }

    .vault-card-preview {
        font-size: 1.2rem;
        letter-spacing: 3px;
        color: black;
        margin-bottom: 15px;
        font-weight: 600;
    }

    .vault-card a {
        font-weight: 600;
        text-decoration: none;
        margin-right: 12px;
    }

    .edit-link {
        color: #0d6efd;
    }

    .delete-link {
        color: #dc3545;
    }

    .copy-btn {
        margin-right: 8px;
        margin-bottom: 8px;
    }
</style>


<h2 class="vault-header">My Vault</h2>

<div class="vault-actions">
    <a href="/Vault/CreateLogin">+ Add Login</a>
    <a href="/Vault/CreateCreditCard">+ Add Credit Card</a>
    <a href="/Vault/CreateIdentity">+ Add Identity</a>
    <a href="/Vault/CreateSecureNote">+ Add Secure Note</a>
</div>


@if (!Model.Any())
{
    <p class="vault-empty">Your vault is empty.</p>
    <p class="vault-empty">Add items using the buttons above.</p>
}
else
{
    <div class="vault-grid">
        @foreach (var item in Model)
        {
            <div class="vault-card">
                <div class="vault-card-title">@item.DisplayName</div>
                <div class="vault-card-type">@item.ItemType</div>
                <div class="vault-card-preview">@item.MaskedPreview</div>

                <!-- COPY BUTTONS BASED ON TYPE -->
                <div class="mb-2">

                    @if (item.ItemType == "LoginItem")
                    {
                        <button class="btn btn-sm btn-outline-primary copy-btn" data-id="@item.Id" data-field="username">Copy Username</button>
                        <button class="btn btn-sm btn-outline-primary copy-btn" data-id="@item.Id" data-field="password">Copy Password</button>
                        <button class="btn btn-sm btn-outline-primary copy-btn" data-id="@item.Id" data-field="url">Copy URL</button>
                    }
                    else if (item.ItemType == "CreditCardItem")
                    {
                        <button class="btn btn-sm btn-outline-primary copy-btn" data-id="@item.Id" data-field="cardnumber">Copy Number</button>
                        <button class="btn btn-sm btn-outline-primary copy-btn" data-id="@item.Id" data-field="cvv">Copy CVV</button>
                    }

                </div>

                <!-- LINKS -->
                <a href="/Vault/View/@item.Id">View</a>
                <a href="/Vault/Edit/@item.Id" class="edit-link">Edit</a>
                <a href="/Vault/Delete/@item.Id" class="delete-link">Delete</a>
            </div>
        }
    </div>
}

@section Scripts {
    <script>
        document.querySelectorAll(".copy-btn").forEach(btn => {
            btn.addEventListener("click", async () => {

                const id = btn.dataset.id;
                const field = btn.dataset.field;

                const res = await fetch("/Vault/CopyField", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/x-www-form-urlencoded"
                    },
                    body: `id=${id}&field=${field}`
                });

                const data = await res.json();

                if (data.value) {

                    await navigator.clipboard.writeText(data.value);

                    // UI feedback
                    const originalText = btn.textContent;
                    btn.textContent = "Copied!";
                    btn.classList.remove("btn-outline-primary");
                    btn.classList.add("btn-success");

                    setTimeout(() => {
                        btn.textContent = originalText;
                        btn.classList.remove("btn-success");
                        btn.classList.add("btn-outline-primary");
                    }, 1500);
                }
            });
        });
    </script>
}
